<script setup lang="ts">
// const { loadAndTypeset } = require("mathjax-electron")
import InputBlock from './InputBlock.vue'
import { ref, onMounted } from 'vue'
import { marked } from 'marked'

var INDENT_LEN: number = 4

const blocks = ref([
    { id: 1, content: 'This is an input block!!' },
])

function renderAll() {
    /**
     * Loop through each input block, concatenate the HTML result.
     */
    var BLOCK_CONTAINER = ref(document.getElementById('input-container') as HTMLDivElement)
    var MD_CONTAINER = ref(document.getElementById('md-container') as HTMLDivElement)
    let htmlResult = ""
    let numBlocks = BLOCK_CONTAINER.value.children.length
    if (numBlocks) {
        for (let i = 0; i < numBlocks; i++) {
            let block = BLOCK_CONTAINER.value?.children[i] as HTMLDivElement
            let md = block?.textContent
            // console.log('md', md)
            if (md) {
                htmlResult += '\n\n' + marked(md)
            }
        }
        MD_CONTAINER.value.innerHTML = htmlResult
        // loadAndTypeset(document, mdContainer)
    }
}

function onInputBlockKeyup(event: KeyboardEvent) {
    console.log('onInputBlockKeyup')
    renderAll()
}

onMounted(() => {
    renderAll()
})

</script>
    
<template>
    <div id="editor-container">
        <div id="input-container">
            <!-- Input blocks here -->
            <InputBlock v-for="block in blocks" :key="block.id" :content="block.content"
                @input-block-keyup="onInputBlockKeyup" />
        </div>
        <div id="preview-container">
            <link href="../styles/github.css" rel="stylesheet">
            <div id="md-container" class="markdown-body">
                <!-- The HTML content be generated by the Markdown renderer -->
            </div>
        </div>
    </div>
</template>
    
<style scope>
/* This should be moved to parent component */
#editor-container {
    display: flex;
    flex-direction: row;
    height: calc(100% - 20px - 26px);
}

#input-container {
    font-family: 'Ubuntu Mono', 'Consolas', 'Courier New', Courier, monospace;
    font-size: 14px;
    width: 50%;
    height: auto;
    padding: 8px;
    margin: 0;
    overflow: auto;
    background-color: #eeeeee;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    gap: 4px;
    /* white-space: pre-wrap; */

    /* Scrollbar */
    scrollbar-width: thin;
    scrollbar-color: rgba(99, 99, 99, 0.2) rgba(99, 99, 99, 0.2);
}

#preview-container {
    padding: 8px;
    width: 50%;
    margin: 0;
    border-left: rgba(99, 99, 99, 0.2) 1px solid;
    /* background-color: bisque; */
    overflow: auto;
    font-size: 14px;

    /* Scrollbar */
    scrollbar-width: thin;
    scrollbar-color: rgba(99, 99, 99, 0.2) rgba(99, 99, 99, 0.2);
}
</style>